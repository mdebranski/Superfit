#= require jquery.min
#= require jquery_ujs
#= require underscore-min
#= require jqtouch.min
#= require jqtouch-jquery.min
#= require jquery.makeItRetina.min
#= require moment.min
#= require spine/spine
#= require spine/manager
#= require spine/ajax
#= require spine/route
#= require_tree ./lib
#= require hamlcoffee
#= require_tree ./superfit/models
#= require_tree ./superfit/controllers
#= require_tree ./superfit/views

class AppInit
  constructor: ->
    $.ajaxSetup
      beforeSend: (xhr) ->
        xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));

    $.get("/models").success (data) ->
      console.log "Data", data
      User.refresh(data.user) if data.user
      Wod.refresh(data.wods)
      Category.refresh(data.categories)
      new Superfit(el: $('body'))

      window.jQT = new $.jQTouch
        icon: 'jqtouch.png'
        icon4: 'jqtouch4.png'
        addGlossToIcon: false
        startupScreen: 'jqt_startup.png'
        statusBar: 'black-translucent'
        preloadImages: []

$ -> new AppInit()

window.fbAsyncInit = ->
  FB.init(appId: '<%= APP_CONFIG.fb_app_id %>', status: true, cookie: true, xfbml: true, oauth: true)
