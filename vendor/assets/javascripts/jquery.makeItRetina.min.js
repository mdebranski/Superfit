/*
 * Make It Retina v1.1 - jQuery Plugin
 * http://www.steviostudio.it
 *
 * Cristoforo Stevio Cervino
 * Date: 28/07/2012
 */
(function(a){a.makeItRetina=function(d){var c={retinaSuffix:"_2x",checkExistenceBefore:true,checkifAlreadyRetina:true,retinaBackgrounds:true,retinaBackgroundsTags:"*",tryEavenforExternalImages:false,consoleDebugMessages:false,makeItRetinaAnyway:false};if(d){a.extend(c,d)}var b=window.devicePixelRatio>1?true:false;a.fn.changeWithRetina=function(e,f){switch(f){case"img":this.attr("src",e);break;case"background":this.css({"background-image":"url("+e+")"});break}};a.fn.addSuffix=function(g,h){var j=this;switch(h){case"img":var f=j.attr("src");break;case"background":var f=j.css("background-image").replace("url(","").replace(")","").replace("'","").replace('"',"");break}var i=f;var e=f.split(".");if(g.checkifAlreadyRetina){if((e[e.length-2].indexOf(g.retinaSuffix))>=0){if(g.consoleDebugMessages){console.log("The image "+f+" is already retina;")}}}e[e.length-1]=(g.retinaSuffix)+"."+e[e.length-1];e[e.length-2]=e[e.length-2]+e[e.length-1];e.splice(e.length-1);f=e.join(".");if(g.checkExistenceBefore){a.ajax({url:f,type:"HEAD",async:true,error:function(){if(g.consoleDebugMessages){console.log("Can not load the image: "+i+".")}},success:function(){j.changeWithRetina(f,h)}})}else{j.changeWithRetina(f,h)}};a.fn.makeMeRetina=function(f,g){switch(g){case"img":var e=this.attr("src");break;case"background":var e=this.css("background-image").replace("url(","").replace(")","").replace("'","").replace('"',"");break}if((e.indexOf("http"))>=0){if((e.indexOf(location.origin))>=0){this.addSuffix(f,g)}else{if(f.tryEavenforExternalImages){this.addSuffix(f,g)}}}else{this.addSuffix(f,g)}};if(b||(c.makeItRetinaAnyway==true)){a(window).load(function(){a("img").each(function(e){a(this).css({width:a(this).width(),height:a(this).height()});var f=a(this).attr("src");if(f!="none"){a(this).makeMeRetina(c,"img")}});if(c.retinaBackgrounds){a(c.retinaBackgroundsTags).each(function(h,j){var g=a(j).css("background-image");var k=a(j).css("background-size");if(g!="none"&&((g.indexOf("http"))>0)){if(k=="auto"){var g=a(j).css("background-image").replace("url(","").replace(")","").replace("'","").replace('"',"");var f=a("<img />");f.hide().attr("src",g);a("body").append(f);f.bind("load",function(){a(this).attr("data-height",a(this).height());a(this).attr("data-width",a(this).width());var e=a(this).attr("data-width")+"px "+a(this).attr("data-height")+"px";a(j).css({"background-size":e}).makeMeRetina(c,"background");a(this).remove()})}else{a(j).makeMeRetina(c,"background")}}})}})}}})(jQuery);